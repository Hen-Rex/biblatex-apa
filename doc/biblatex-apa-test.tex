\documentclass[paper=a4]{article}
\usepackage[american]{babel}
\usepackage{csquotes}
\usepackage{shortvrb}
\usepackage{ifthen}
\usepackage{color}
\usepackage[retainmissing]{MnSymbol}
\usepackage[top=2.5cm]{geometry}

% Unicode
\usepackage{fontspec}
\setmainfont[Ligatures=TeX]{TeXGyrePagella}
\setsansfont[Ligatures=TeX]{TexGyreHeros}
\setmonofont[Ligatures=NoCommon]{TeXGyreCursor}
\MakeAutoQuote{«}{»}
\maxdeadcycles=1000
% Biblatex
\usepackage[style=apa]{biblatex}

%REMOVE
% Custom settings for misc entries in order to format the table for 6.13*
% This table implies that the examples on each line are in a separate
% document but since we are generating the citations from a real data
% source, we have to prevent the usual uniquelist processing by making
% all of the examples MISC entrytypes and changing uniquelist
% per-type. There is no point in just typesetting static data as this
% wouldn't be a test of anything.
% \ExecuteBibliographyOptions[misc]{uniquelist=false}
% \DeclareNameFormat[misc]{labelname}{%
%   \ifthenelse{\value{listcount}=1\OR\value{listtotal}=2}
%     {\usebibmacro{labelname:doname}
%       {\namepartfamily}
%       {\namepartfamilyi}
%       {\namepartgiven}
%       {\namepartgiveni}
%       {\namepartprefix}
%       {\namepartprefixi}
%       {\namepartsuffix}
%       {\namepartsuffixi}}
%     {\ifthenelse{\value{listtotal}>5}
%       {\ifnum\value{listcount}=2 \andothersdelim\bibstring{andothers}\fi
%        \ifnum\value{listcount}>2 \relax\fi}
%       {\ifciteseen
%        {\ifnum\value{listcount}=2 \andothersdelim\bibstring{andothers}\fi
%         \ifnum\value{listcount}=3 \relax\fi
%         \ifnum\value{listcount}=4 \relax\fi
%         \ifnum\value{listcount}=5 \relax\fi}
%        {\usebibmacro{labelname:doname}
%          {\namepartfamily}
%          {\namepartfamilyi}
%          {\namepartgiven}
%          {\namepartgiveni}
%          {\namepartprefix}
%          {\namepartprefixi}
%          {\namepartsuffix}
%          {\namepartsuffixi}}}}}
\MakeShortVerb{\|}

\newcommand\apa[2][]{\ifthenelse{\equal{#1}{}}%
                       {\textcolor{blue}{\texttt{(APA #2)}}}%
                       {\textcolor{blue}{\texttt{(APA #2 Example #1)}}}}

\setlength{\parskip}{3ex}

\makeatletter
% This solution to detokenize leaving a space after the command and
% arguments is due to Bruno Le Floch on T.SE
\long\def\apaexi#1{%
  \catcode64=11
  \begingroup
  % Ensure that every character is preserved by \lowercase.
  \count@\z@
  \loop\ifnum\count@<256
    \lccode\count@\z@
    \advance\count@\@ne
  \repeat
  % Except spaces, changed to ^^A
  \lccode32=\@ne
  \lowercase{%
    \endgroup
    \expandafter\test@\detokenize{#1}\relax%
    \catcode64=12}}
% Then map {^^A => space, space =>} onto the string.
\def\test@#1{%
  \ifx#1\relax\test@end\fi
  \ifnum`#1=\@ne\space\else#1\fi
  \test@}
\def\test@end\fi#1\test@{\fi}

\def\apaex#1{\hbox{\hspace{-4em}\texttt{\small\apaexi{#1}}}\\$\rcurvearrowse$ \textbf{#1}}
\def\apaexs#1{\hbox{\texttt{\footnotesize\apaexi{#1}}} \textbf{\small #1}}
\makeatother

% This just makes it easier to find a specific (APA 7.x) example in the
% typeset references section
\reversemarginpar
\renewbibmacro*{begentry}{\marginpar{\footnotesize \textcolor{blue}{\thefield{entrykey}}}}

\usepackage[colorlinks=true]{hyperref}

%%%%%%%%%%%%%%%%%%%%%%%%%%%% END PREAMBLE %%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}
\section*{|biblatex-apa| style examples}
This file typesets just about all useful examples from \apa{8}--\apa{10}.
Also included are some clarifications from the APA blog
(\url{http://blog.apastyle.org/apastyle/}). Please refer to the
|biblatex-apa-test-references.bib| file for details on the references
entries. The |.bib| key for each entry in the References section is listed
for convenience in the left margin. The keys are not arbitrary and consist
of the APA section they are taken from, followed by a colon,
followed by the example number. This makes it easier to cross-reference the
typeset examples with the commented |.bib| file. I chose not to put the
examples in the References section in example number order so that the APA
requirements for References list alphabetisation and order could also be
demonstrated.

\section*{Citations}
\begin{refsection}[../bibtex/bib/biblatex-apa-test-citations]
\noindent Please see accompanying file |biblatex-apa-test-citations.bib|
for the bibliographic entries which these examples use.

\noindent\apa{8.6}\\
Secondary sources. The example in APA 7th is inconsistent with other
examples of similar format which use a semi-colon:\\
\apaex{\parencites{8.6a}[as cited in][]{8.6b}}\\\\
\noindent To obtain the exact format, if desired, wrap the citation in:\\
|\DeclareDelimFormat{multicitedelim}{\addcomma\space}|\\
|\DeclareDelimFormat{multicitedelim}{\addsemicolon\space}|\\
\DeclareDelimFormat{multicitedelim}{\addcomma\space}\\
\apaex{\parencites{8.6a}[as cited in][]{8.6b}}\\
\DeclareDelimFormat{multicitedelim}{\addsemicolon\space}\\
\noindent Primary source with no date:\\
\apaex{Allport's diary \parencite[as cited in][]{8.6c}}

\noindent\apa{8.9}\\
Such cases are just typed out--they have no Reference section entry and
don't therefore have a bibliography database entry.

\noindent\apa{8.10}\\
Simple cite. «Jr.» suffix is not shown (bib entry for this example has a suffix):\\
\apaex{\textcite{8.10a}}\\

\noindent Testing seasonal periodical citations--should be ignored and only
year printed:\\
\apaex{\textcite{8.10b}}

\noindent\apa{8.11}\\
Within a paragraph, not in the narrative sense:\\
\apaex{\autocite{8.11a}}

\noindent Within parentheses, use the |\nptextcite| command which is equivalent to
the |\textcite| command but omits the parenthesis and uses commas instead.
See the |biblatex-apa| docs.\\
\apaex{(\nptextcite[see][for more detail]{8.11a})}\\
\apaex{(e.g., falsely balanced news coverage; \nptextcite{8.11a})}\\
\apaex{\textcite{8.11a} noted the dangers of falsely balanced news coverage.}\\
\apaex{In \citeyear{8.11a}, \citeauthor{8.11a} noted the dangers of falsely balanced news coverage.}

\noindent\apa{8.12}\\
Citing multiple works:\\
\apaex{\parencite{8.12a,8.12b,8.12c}}\\
\apaex{\parencite{8.12d,8.12e,8.12f,8.12g}}\\
\apaex{\parencite{8.12h,8.12i,8.12j,8.12k}}\\
\apaex{\parencite{8.12l,8.12m,8.12n}}\\
\apaex{\parencites{8.12o}[see also][]{8.12p,8.12q, 8.12r}}

\noindent «in press» should have hyphen before disambiguating part of label\\
\apaex{\parencite{8.12s,8.12t,8.12u}}

\noindent\apa{8.13}\\
Classical and part works:\\
\apaex{\parencite[10]{8.13a}}\\
\apaex{\parencite[Chapter 3]{8.13b}}\\
\apaex{\parencite[3--17]{8.13c}}\\
\apaex{\parencite[paras. 2--3]{8.13d}}\\
\apaex{\parencite[Table 1]{8.13e}}\\
\apaex{\parencite[Slide 7]{8.13f}}\\
\apaex{\parencite[1:30:40]{8.13g}}\\
\apaex{\parencite[1 Cor. 13:1]{8.13h}}\\
\apaex{\parencite[Part IV]{8.13i}}\\
\apaex{\parencite[\nopp 1.3.36--37]{8.13j}}\\\\
Note the use of |\nopp| in the Shakespeare example to suppress the
pagination prefix since the part specification is auto-detected as a range
by |biblatex| which it then assumes is a page range. Note also the date
format for the Aristotle example, see the reference file for the data
format--no special formatting is required by the user as |biblatex| fully
supports the relevant parts of the ISO 8601 specification and can
parse/format such dates automatically.

\noindent\apa{8.14}\\
Use |SHORTTITLE| field of the entry if it exists:\\
\apaex{\parencite{8.14a}}\\\\
Articles use quotes instead of italics:\\
\apaex{\parencite{8.14b}}\\\\
Citing anonymous author:\\
\apaex{\parencite{8.14c}}

\noindent\apa{8.15}\\
Citations with reprint/reissue dates:\\
\apaex{\textcite{8.15a}}\\
\apaex{\parencite{8.15b}}

\noindent\apa{8.17}\\
Basic in-text citation styles:\\
\begin{center}
\begin{tabular}{p{0.33\textwidth}p{0.33\textwidth}p{0.33\textwidth}}
  \textbf{Author type} & \textbf{Parenthetical citation} & \textbf{Narrative citation}\\\\
  \hline
  \\
  One author & \apaexs{\parencite{8.17a}} & \apaexs{\textcite{8.17a}}\\\\
  Two authors & \apaexs{\parencite{8.17b}} & \apaexs{\textcite{8.17b}}\\\\
  Three or more authors & \apaexs{\parencite{8.17c}} & \apaexs{\textcite{8.17c}}\\\\
  Group author with abbreviation & &\\
  ~~First citation & \apaexs{\parencite{8.17d}}\citeresetapa & \apaexs{\textcite{8.17d}}\\\\
  ~~Subsequent citations & \apaexs{\parencite{8.17d}} & \apaexs{\textcite{8.17d}}\\\\
  Group author without abbreviation & \apaexs{\parencite{8.17e}} & \apaexs{\textcite{8.17e}}\\\\
  \hline
\end{tabular}
\end{center}

\noindent Authors in narrative citations are separated by «and».
However, in parenthetical cites, authors are separated by «\&»:\\
\apaex{\parencite{8.17f}}\\
\apaex{\textcite{8.17g}}\\
\apaex{\parencite{8.17h}}

\noindent Automatic list disambiguation for ambiguous truncations. Note
that «et al» is plural so it will only truncate two or more names. If it
would truncate just one name, we just give the name:\\
\apaex{\textcite{8.18a}}\\
\apaex{\textcite{8.18b}}\\
\apaex{\textcite{8.18c}}\\
\apaex{\textcite{8.18d}}

\noindent Automatic list disambiguation is only for ambiguous author lists
in the same year. This is implied in \apa{8.18} by the phrase «the same
in-text citation form». So these are not disambiguated:\\
\apaex{\textcite{8.18e}}\\
\apaex{\textcite{8.18f}}

\noindent\apa{8.19}\\
Citations of works by same authors in the same year:\\
\apaex{\parencite{8.19a}}\\
\apaex{\textcite{8.19b}}\\
\apaex{\parencite{8.19c,8.19d}}

\noindent\apa{8.20}\\
Citations of an entry with an author who shares a surname with another
entry always appears with initials when primary author:\\
\apaex{\parencite{8.20a,8.20b}}

\noindent When initials are also the same, revert to standard format:\\
\apaex{\parencite{8.20c,8.20d}}

\noindent Only the primary author should have initials:\\
\apaex{\parencite{8.20f,8.20g,8.20h,8.20i,8.20j}}\\

\noindent Authors in same reference with same surname:\\
\apaex{\parencite{8.20e}}

\noindent\apa{8.21}\\
Group author abbreviations should work between citations of different works by
the author:\\
\apaex{\parencite{8.21a}}\\
\apaex{\parencite{8.21a}}\\
\apaex{\parencite{8.21b}}

\noindent Testing suffices\\
\apaex{\textcite{stest1}}\\
\apaex{\textcite{stest2}}

\noindent Testing prefices\\
\apaex{\textcite{pretest}}\\
\apaex{\textcite{nopretest}}

% presufftest2 and nopresufftest are the same name and so even though
% useprefix=false nopresufftest, hashes are the same so there is an extradate
\noindent Testing prefices plus suffices\\
\apaex{\textcite{presufftest}}\\
\apaex{\textcite{presufftest2}}\\
\apaex{\textcite{nopresufftest}}

\noindent Testing «and others»\\
\apaex{\textcite{ao1}}\\
\apaex{\textcite{ao2}}

% Testing name elision in cites
% That is, \parencite{kingetal2005a,weissetal2007a,weissetal2009a}
% Should give:
% (King, Weiss, & Farmer, 2005; Weiss, King, & Hopkins, 2007; Weiss et al., 2009)
% and not
% (King, Weiss, & Farmer, 2005; Weiss, King, & Hopkins, 2007, 2009)
% which happens if elision is based on namehash because the mincitenames
% truncation of the 2007 and 2009 names is the same
\noindent{Testing name elision in cites}\\
\apaex{\parencite{kingetal2005a,weissetal2007a,weissetal2009a}}

\noindent Testing citation formats for complete dates\\
\apaex{\textcite{Ludwig2014}}

\noindent Testing month ranges with same months, different days\\
\apaex{\textcite{daterange1}}

\noindent Testing month ranges with different months\\
\apaex{\textcite{daterange2}}

\end{refsection}
\begin{refsection}[../bibtex/bib/biblatex-apa-test-references]
\section*{APA 10--Citations and References}
\subsection*{APA 10.1--Periodicals}

\noindent\apa{10.1:1}\\
\apaex{\parencite{10.1:1}}\\
\apaex{\textcite{10.1:1}}

\noindent\apa{10.1:2}\\
\apaex{\parencite{10.1:2}}\\
\apaex{\textcite{10.1:2}}

\noindent\apa{10.1:3}\\
\apaex{\parencite{10.1:3a,10.1:3b}}\\
\apaex{\textcite{10.1:3a} and \textcite{10.1:3b}}

\noindent\apa{10.1:4}\\
\apaex{\parencite{10.1:4}}\\
\apaex{\textcite{10.1:4}}

\noindent\apa{10.1:5}\\
\apaex{\parencite{10.1:5}}\\
\apaex{\textcite{10.1:5}}

\noindent\apa{10.1:6}\\
\apaex{\parencite{10.1:6}}\\
\apaex{\textcite{10.1:6}}

\noindent\apa{10.1:7}\\
\apaex{\parencite{10.1:7}}\\
\apaex{\textcite{10.1:7}}

\noindent\apa{10.1:8}\\
\apaex{\parencite{10.1:8}}\\
\apaex{\textcite{10.1:8}}

\noindent\apa{10.1:9}\\
\apaex{\parencite{10.1:9}}\\
\apaex{\textcite{10.1:9}}

\noindent\apa{10.1:10}\\
\apaex{\parencite{10.1:10}}\\
\apaex{\textcite{10.1:10}}

\noindent\apa{10.1:11}\\
\apaex{\parencite{10.1:11}}\\
\apaex{\textcite{10.1:11}}

\noindent\apa{10.1:12}\\
\apaex{\parencite{10.1:12a,10.1:12b}}\\
\apaex{\textcite{10.1:12a} and \textcite{10.1:12b}}

\noindent\apa{10.1:13}\\
\apaex{\parencite{10.1:13}}\\
\apaex{\textcite{10.1:13}}

\noindent\apa{10.1:14}\\
\apaex{\parencite{10.1:14}}\\
\apaex{\textcite{10.1:14}}

\noindent\apa{10.1:15}\\
\apaex{\parencite{10.1:15a,10.1:15b,10.1:15c}}\\
\apaex{\textcite{10.1:15a}, \textcite{10.1:15b}, and \textcite{10.1:15c}}

\noindent\apa{10.1:16}\\
\apaex{\parencite{10.1:16a,10.1:16b}}\\
\apaex{\textcite{10.1:16a} and \textcite{10.1:16b}}

\noindent\apa{10.1:17}\\
\apaex{\parencite{10.1:17}}\\
\apaex{\textcite{10.1:17}}

\noindent\apa{10.1:18}\\
\apaex{\parencite{10.1:18}}\\
\apaex{\textcite{10.1:18}}

\noindent\apa{10.1:19}\\
\apaex{\parencite{10.1:19}}\\
\apaex{\textcite{10.1:19}}

\subsection*{APA 10.2--Books and Reference Works}

\noindent\apa{10.2:1}\\
\apaex{\parencite{10.2:1}}\\
\apaex{\textcite{10.2:1}}

\end{refsection}
\newpage
% Just (APA 10.x) real references and related entry examples here
\printbibliography[section=2]
\newpage
% Include a references section for citation examples just so hyperref
% targets can be checked
\printbibliography[section=1,title=Misc citation references]
\end{document}

